<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Slide Viewer</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>
<body class="bg-slate-900 text-white min-h-screen font-sans">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function SlideViewer() {
      const [slides, setSlides] = useState([]);
      const [current, setCurrent] = useState(0);
      const [fileName, setFileName] = useState('');
      const [loading, setLoading] = useState(false);
      const [pdfJsLoaded, setPdfJsLoaded] = useState(false);

      useEffect(() => {
        if (window.pdfjsLib) {
          window.pdfjsLib.GlobalWorkerOptions.workerSrc =
            'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
          setPdfJsLoaded(true);
        }
      }, []);

      const handleFileUpload = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        if (!pdfJsLoaded) return alert('PDF library loading, try again.');
        if (file.type !== 'application/pdf') return alert('Only PDF supported. Export PPTX to PDF first.');

        document.title = file.name;
        setFileName(file.name);
        setLoading(true);
        const data = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data }).promise;
        const imgs = [];
        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const viewport = page.getViewport({ scale: 2 });
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          canvas.height = viewport.height;
          canvas.width = viewport.width;
          await page.render({ canvasContext: ctx, viewport }).promise;
          imgs.push(canvas.toDataURL());
        }
        setSlides(imgs);
        setLoading(false);
      };

      const next = () => current < slides.length - 1 && setCurrent(current + 1);
      const prev = () => current > 0 && setCurrent(current - 1);

      useEffect(() => {
        const keyHandler = (e) => {
          if (e.key === 'ArrowRight') next();
          if (e.key === 'ArrowLeft') prev();
          if (e.key.toLowerCase() === 'f') document.documentElement.requestFullscreen();
          if (e.key.toLowerCase() === 'p') window.print();
        };
        window.addEventListener('keydown', keyHandler);
        return () => window.removeEventListener('keydown', keyHandler);
      }, [current, slides]);

      return (
        <div className="flex flex-col min-h-screen">
          <div className="flex items-center justify-between bg-slate-800 px-6 py-4 border-b border-slate-700">
            <div className="flex items-center gap-3">
              <h1 className="text-lg font-medium">Slide Viewer</h1>
              {fileName && <span className="text-slate-400 text-sm">{fileName}</span>}
            </div>
            <div className="flex gap-2">
              <a href="index.html" className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-md text-sm">Home</a>
              <label className="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md text-sm cursor-pointer">
                Upload
                <input type="file" accept=".pdf" onChange={handleFileUpload} className="hidden" />
              </label>
              <button onClick={() => document.documentElement.requestFullscreen()} className="px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-md text-sm">Fullscreen</button>
              <button onClick={() => document.exitFullscreen()} className="px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-md text-sm">Exit</button>
              <button onClick={() => window.print()} className="px-3 py-2 bg-green-600 hover:bg-green-700 rounded-md text-sm">Print</button>
            </div>
          </div>

          <div className="flex-1 flex items-center justify-center p-6">
            {loading ? (
              <p className="text-slate-400">Loading slides...</p>
            ) : slides.length === 0 ? (
              <p className="text-slate-400">Upload a PDF to start viewing.</p>
            ) : (
              <img src={slides[current]} alt={`Slide ${current + 1}`} className="max-h-[80vh] mx-auto object-contain" />
            )}
          </div>

          {slides.length > 0 && (
            <div className="flex items-center justify-between bg-slate-800 px-6 py-3 border-t border-slate-700">
              <button onClick={prev} disabled={current === 0} className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-md disabled:opacity-40 text-sm">Prev</button>
              <span className="text-slate-400 text-sm">
                {current + 1} / {slides.length}
              </span>
              <button onClick={next} disabled={current === slides.length - 1} className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-md disabled:opacity-40 text-sm">Next</button>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<SlideViewer />, document.getElementById('root'));
  </script>
</body>
</html>
